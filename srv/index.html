{{- $hostName := .Host -}}
{{- $xff := .Req.Header.Get "X-Forwarded-For" -}}
{{- $ip := first (.Req.Header.Get "X-Forwarded-For" | splitList ",") -}}
{{- $now := now | date "Jan 2, 2006 15:04:05 MST" -}}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Test your IPv6 connectivity on a dualstack load balancer.">
  {{- if eq $hostName "v4.mechapower.com"}}
  <title>IPv4-Only Test Page</title>
  {{- else if eq $hostName "v6.mechapower.com"}}
  <title>IPv6-Only Test Page</title>
  {{- else}}
  <title>Dualstack IPv6/IPv4 Test Page</title>
  {{ end -}}
  <link rel="stylesheet" type="text/css" href="/assets/styles.min.css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="manifest" href="/assets/site.webmanifest">
  <link rel="canonical" href="https://ipv6test.mechapower.com" />
  {{- if eq $hostName "ipv6test.mechapower.com"}}
  <link rel="dns-prefetch" href="//v6.mechapower.com/">
  <link rel="dns-prefetch" href="//v4.mechapower.com/">
  {{- else}}
  <link rel="dns-prefetch" href="//v4.mechapower.com/">
  {{- end }}
</head>

<body>
  <div class="mx-2 md:container md:mx-auto md:max-w-screen-md py-5">
    <div class="flex py-5 justify-center space-x-4 font-bold text-center sticky top-0 bg-white bg-opacity-75">
      <a href="https://ipv6test.mechapower.com/" class="nav-button" rel="noopener">Dualstack Page</a>
      <a href="https://v6.mechapower.com/" class="nav-button" rel="noopener">IPv6-Only Page</a>
      <a href="https://v4.mechapower.com/" class="nav-button" rel="noopener">IPv4-Only Page</a>
    </div>
    <div id="emoji" class="text-8xl h-64 flex items-center justify-center"></div>
    <div class="text-center text-2xl py-5">
      <h3 id="message"></h3>
    </div>
    <div id="ip-report" class="border-4 rounded-xl p-0 mb-8">
      <div id="ip-report-title" class="pt-2 pb-3 text-center text-white font-bold align-middle">
        Your IP Address
      </div>
      <div id="ip" class="text-center py-5 text-sm md:text-3xl monospace">
        {{ $ip }}
      </div>
    </div>
    <div id="wall-of-text">
      {{- if eq $hostName "v4.mechapower.com" -}}
      {{- include "/markdown/ipv4.md" | markdown | wrap 80 | nindent 6 }}
      {{- else if eq $hostName "v6.mechapower.com" -}}
      {{include "/markdown/ipv6.md" | markdown | wrap 80 | nindent 6 }}
      {{- else -}}
      {{include "/markdown/dualstack.md" | markdown | wrap 80 | nindent 6 }}
      {{- end -}}
    </div>
    <h3 class="text-center text-2xl py-5">Get your IP from the command line!</h3>
    <div class="cmd-container">
      <div class="cmd-container__title">
        cURL
      </div>
      <div class="cmd-container__cmd">
        curl {{ $hostName }}
      </div>
    </div>
    <div class="cmd-container">
      <div class="cmd-container__title">
        HTTPie
      </div>
      <div class="cmd-container__cmd">
        http -b {{ $hostName }}
      </div>
    </div>
    <div class="cmd-container">
      <div class="cmd-container__title">
        Wget
      </div>
      <div class="cmd-container__cmd">
        wget -qO- {{ $hostName }}
      </div>
    </div>
    <div class="cmd-container">
      <div class="cmd-container__title">
        Plain output (any User-Agent)
      </div>
      <div class="cmd-container__cmd">
        http://{{ $hostName }}/ip
      </div>
    </div>
    <footer class="text-center text-sm border-t border-gray-200 py-5 mt-2">
      Page generated on: {{ $now }}
    </footer>
  </div>
  <script src="/assets/scripts.min.js"></script>
</body>

</html>