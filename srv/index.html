{{- $hostName := .Host -}}
{{- $xff := .Req.Header.Get "X-Forwarded-For" -}}
{{- $ip := first (.Req.Header.Get "X-Forwarded-For" | splitList ",") -}}
{{- $now := now | date "Jan 2, 2006 15:04:05 MST" -}}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Test your IPv6 connectivity on a dualstack load balancer.">
  {{- if eq $hostName "v4.ipv6test.app"}}
  <title>IPv4-Only Test Page</title>
  {{- else if eq $hostName "v6.ipv6test.app"}}
  <title>IPv6-Only Test Page</title>
  {{- else}}
  <title>Dualstack IPv6/IPv4 Test Page</title>
  {{ end -}}
  <link rel="stylesheet" type="text/css" href="/assets/styles.min.css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="manifest" href="/assets/site.webmanifest">
</head>

<body>
  <div class="main">
    <div class="nav">
      <a href="https://ipv6test.app/" class="nav-button">Dualstack Page</a>
      <a href="https://v6.ipv6test.app/" class="nav-button">IPv6-Only Page</a>
      <a href="https://v4.ipv6test.app/" class="nav-button">IPv4-Only Page</a>
    </div>
    <div id="emoji"></div>
    <h3 id="message"></h3>
    <div id="ip-report" class="border-4 rounded-xl p-0 mb-8">
      <div id="ip-report-title">
        Your IP Address
      </div>
      <div id="ip">
        {{ $ip }}
      </div>
    </div>
    <div id="wall-of-text">
      {{- if eq $hostName "v4.ipv6test.app" -}}
      {{- include "/markdown/ipv4.md" | markdown | wrap 80 | nindent 6 }}
      {{- else if eq $hostName "v6.ipv6test.app" -}}
      {{ include "/markdown/ipv6.md" | markdown | wrap 80 | nindent 6 }}
      {{- else -}}
      {{ include "/markdown/dualstack.md" | markdown | wrap 80 | nindent 6 }}
      {{- end }}
    </div>
    <h3>Get your IP from the command line!</h3>
    <div class="cmd-container">
      <div class="cmd-container__title">
        cURL
      </div>
      <div class="cmd-container__cmd">
        curl {{ $hostName }}
      </div>
    </div>
    <div class="cmd-container">
      <div class="cmd-container__title">
        HTTPie
      </div>
      <div class="cmd-container__cmd">
        http -b {{ $hostName }}
      </div>
    </div>
    <div class="cmd-container">
      <div class="cmd-container__title">
        Wget
      </div>
      <div class="cmd-container__cmd">
        wget -qO- {{ $hostName }}
      </div>
    </div>
    <div class="cmd-container">
      <div class="cmd-container__title">
        Plain output (any User-Agent)
      </div>
      <div class="cmd-container__cmd">
        http://{{ $hostName }}/ip
      </div>
    </div>
    <footer>
      <div>
        Page generated on: {{ $now }}
      </div>
      <a class="icon" href="https://github.com/misterorion/ipv6test">
        <img src="/assets/github.svg" alt="github" width="46">
      </a>
      <a class="icon" href="mailto:tech-admin@mechapower.com">
        <img src="/assets/email.svg" alt="email" width="46">
      </a>
    </footer>
  </div>
  <script src="/assets/scripts.min.js"></script>
</body>

</html>